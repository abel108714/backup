Sub testSubExp()
'
' Macro4 Macro
'

'
'
    'Columns("C:C").Select '選取
    'Selection.Cut '剪下
    'Columns("E:E").Select '選取
    'Selection.Insert Shift:=xlToRight '貼上

    swapColumns "C:C", "E:E"
    MsgBox ("CE交換完成")
    hiddenColumns "J:J"
    MsgBox ("J行隱藏完成")
    displayColumns "J:J"
    MsgBox ("J行取消隱藏完成")
    freezeFirstColumns True
    MsgBox ("A行凍結完成")
    freezeFirstColumns False
    MsgBox ("A行取消凍結完成")
    
    'Dim str1, str2, str3, str4, str5 As String
    'str1 = StrComp("Taiwan", "Taiwan")
    'MsgBox (str1)
    'str2 = StrComp("Taiwan", "Tai")
    'MsgBox (str2)
    'str3 = StrComp("Taiwan", "wan")
    'MsgBox (str3)
    'str4 = StrComp("Taiwan", "weirugwegTaiwanshosihjioahj")
    'MsgBox (str4)
    'str5 = StrComp("Taiwan", "weirugwegTaishshrthwanshosihjioahj")
    'MsgBox (str5)
    
    strCompare
    
    
    
    
End Sub
Sub swapColumns(s1 As String, S2 As String) '交換兩行
    Columns(s1).Select '選取
    Selection.Cut '剪下
    Columns(S2).Select '選取
    Selection.Insert Shift:=xlToRight '貼上
End Sub
Sub hiddenColumns(s1 As String) '隱藏行
    Columns(s1).Select '選取
    Selection.EntireColumn.Hidden = True '隱藏
End Sub
Sub displayColumns(s1 As String) '取消隱藏行
    Columns(s1).Select '選取
    Selection.EntireColumn.Hidden = False '隱藏
End Sub
Sub freezeFirstColumns(s1 As String) '是否凍結首行
    If s1 Then
        With ActiveWindow
            .SplitColumn = 1
            .SplitRow = 0
        End With
        ActiveWindow.FreezePanes = True
    Else
        With ActiveWindow
            .SplitColumn = 0
            .SplitRow = 0
        End With
        ActiveWindow.FreezePanes = False
    End If
End Sub
Function strCompare(s1 As String, S2 As String) As Boolean
    If StrComp(s1, S2) = 0 Then 'VBA的0是false所以要再多一個判斷才能回傳True
        strCompare = True
        'MsgBox True
    Else
        strCompare = False
        'MsgBox False
    End If
End Function

Sub Ex()
    Dim e As Range, i
    For Each e In Sheet1.Range("A:A").SpecialCells(xlCellTypeConstants)
        i = Application.Match(e, sheet2.Range("A:A"), 0)
        If IsNumeric(i) Then e.End(xlToRight).Offset(, 1) = sheet2.Cells(i, "B")
    Next
End Sub

Sub Connect2Mysql()
'Dim Server_Name, Database_Name, User_ID, Password As String

Dim conn As New ADODB.connection
Dim Rs As New ADODB.Recordset
'Set conn = New ADODB.Connection

Server_Name = "localhost"       ' 伺服器IP，127.0.0.1為目前本機
Database_Name = "numbersDB"       ' 連線資料庫名稱
User_ID = "root"         ' 資料庫登入帳號
Password = "aa461192"       ' 資料庫登入密碼


Dim connStr As String  '資料庫連線字串，其中5.1為ODBC驅動程式版本，要配合你安裝的驅動。
connStr = "DRIVER=MySQL ODBC 5.3 Unicode Driver" _
                    & ";SERVER=" & Server_Name _
                    & ";DATABASE=" & Database_Name _
                    & ";UID=" & User_ID _
                    & ";PWD=" & Password _
                    & ";OPTIONS=3"
                
conn.Open connStr


    
End Sub
Sub SQLTest()
    '連接資料庫
    Connect2Mysql
Dim connection As New connection


    '定義SQl語法並執行
    Dim oConn As New ADODB.connection
    Set Rs = New ADODB.Recordset
    strSQL = "SELECT * FROM numbers"
    MsgBox "here"
    Rs.Open strSQL, connStr, adOpenDynamic, adLockOptimistic
    
    '一筆一筆的拿資料
    

    Do Until Rs.EOF
    
        '選擇要貼上的欄位

        Range("A1").Select
        ActiveCell = Rs.Fields("M16")
        strOutput = Rs.Fields("id")
        Rs.MoveNext
    Loop
    
    Rs.Close
    'MsgBox strOutput
    oConn.Close
    Set oConn = Nothing
    Set Rs = Nothing

End Sub
Sub sql()


    Dim Cn As New ADODB.connection
    Dim Rs As New ADODB.Recordset
    Dim sql As String

    SQLIP = "localhost"
    SQLNAME = "membersDB"
    SQLID = "root"
    SQLPWD = "aa461192"
    Cn.Open "DRIVER=MySQL ODBC 5.3 Unicode Driver;SERVER=" & Trim(SQLIP) & _
    ";DATABASE=" & Trim(SQLNAME) & _
    ";UID=" & Trim(SQLID) & _
    ";password=" & Trim(SQLPWD)
    
    Dim f4, g4, i4, d4, e4 As String
    Range("F4").Select
    f4 = ActiveCell
    Range("G4").Select
    g4 = ActiveCell
    Range("I4").Select
    i4 = ActiveCell
    Range("D4").Select
    d4 = ActiveCell
    Range("E4").Select
    e4 = ActiveCell
    'ActiveSheet.Range("F4:E4").Select
    
    sql = "update members " & _
        "set Chk = 1, DP = " & f4 & ", TP = " & g4 & ", reach_R = " & i4 & _
        " where dept = " & Chr(34) & d4 & Chr(34) & " AND name = " & Chr(34) & e4 & Chr(34) & ";"
    MsgBox sql

    
    Cn.Execute (sql)
    
    
    Dim s1 As String
    s1 = "123"
    s1 = s1 & "56564"
    MsgBox s1
    
    
    Dim x As Integer
    x = 70

    Dim strtest As String
    
    
    Select Case x
    Case 5
      strtest = strtest & "1"
    Case 6, 8
      strtest = strtest & "1"
    Case 7, 9
      sstrtest = strtest & "1"
    Case 10
      strtest = strtest & "1"
    Case Else
      strtest = strtest & "1"
    End Select
    
    
'    Dim s2Array(totalRow, totalCol)
'For iRow = 1 To totalRow
'    For iCol = 1 To totalCol
'        s2Array(iRow, iCol) = Cells(iRow, iCol)
'    Next iCol
'Next iRow
'For Each str In strArr
'  MsgBox (s)
'Next s

'sql = setDataColumnCMD(4)
'MsgBox sql
    
End Sub
Sub record_test()

    'Dim clipboard As MSForms.DataObject
'Set clipboard = New MSForms.DataObject
    Dim Cn As New ADODB.connection
    Dim Rs As New ADODB.Recordset
    Dim sql As String

    SQLIP = "localhost"
    SQLNAME = "membersDB"
    SQLID = "root"
    SQLPWD = "aa461192"
    Cn.Open "DRIVER=MySQL ODBC 5.3 Unicode Driver;SERVER=" & Trim(SQLIP) & _
    ";DATABASE=" & Trim(SQLNAME) & _
    ";UID=" & Trim(SQLID) & _
    ";password=" & Trim(SQLPWD)
    
    
    '計算當日有業績的業務員數量
    sql = "select count(*) from members where target > 0 AND DP > 0;"
    Rs.Open sql, Cn, 3
    Dim t As Integer
    t = Rs.Fields("count(*)")
    'MsgBox ("t = " & t)
    
    Dim base As Integer
    Dim endString As String
    
    base = 4
    i = base
    j = 4
    endString = "開發"
    Do While Cells(i, j).Select <> "" '若不為空就繼續
    Cells(i, j).Select
    d4 = ActiveCell
    Cells(i, j + 1).Select
    e4 = ActiveCell
    Cells(i, j + 2).Select 'Range("F4").Select 等同於 Cells(4, 6).Select
    f4 = ActiveCell
    Cells(i, j + 3).Select
    g4 = ActiveCell
    Cells(i, j + 4).Select
    h4 = ActiveCell
    Cells(i, j + 5).Select
    i4 = ActiveCell
    'MsgBox ("i4 = " & i4)
    Cells(i, j + 6).Select
    J4 = ActiveCell
    Cells(i, j + 7).Select
    k4 = ActiveCell
    Cells(i, j + 8).Select
    l4 = ActiveCell
    Cells(i, j + 9).Select
    m4 = ActiveCell
    Cells(i, j + 10).Select
    n4 = ActiveCell
    Cells(i, j + 11).Select
    o4 = ActiveCell
    'MsgBox ("o4 = " & o4)
    Cells(i, j + 12).Select
    p4 = ActiveCell
    Cells(i, j + 13).Select
    q4 = ActiveCell
    'MsgBox ("q4 = " & q4)
    'MsgBox ("i = " & i)
    'MsgBox ("t + base = " & (t + base))
    If strCompare(endString, Cells(i, j).Value) = True Then
        'MsgBox ("跳出")
        Exit Do
    End If
    'MsgBox ("繼續")

    
    
    sql = "update members " & _
        "set Chk = 1, DP = " & f4 & ", TP = " & g4 & ", Target = " & h4 * 1000 & ", reach_R = " & i4 & _
        ", BGM_DP = " & Chr(34) & J4 & Chr(34) & ", BGM_TP = " & Chr(34) & k4 & Chr(34) & ", BGC_DP = " & Chr(34) & l4 & Chr(34) & ", BGC_TP = " & Chr(34) & m4 & Chr(34) & ",TH_DP = " & Chr(34) & n4 & Chr(34) & ", TH_TP = " & Chr(34) & o4 & Chr(34) & ",IRHD_DP = " & Chr(34) & p4 & Chr(34) & ",IRHD_TP = " & Chr(34) & q4 & Chr(34) & _
        " where dept = " & Chr(34) & d4 & Chr(34) & " AND name = " & Chr(34) & e4 & Chr(34) & ";"
        
            'MsgBox sql
            
            'MsgBox ("i = " & i & "," & " j = " & j)
        Cn.Execute (sql)
    i = i + 1
    
    Loop
    
    
    
    '選擇有業績目標且chk=0的資料列插入各別部門
    '
    'Rows("18:18").Select
    'Range("C18").Activate
    'Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
    
    
'    Rs.Open "select Dept,Name,DP,TP,Target,Reach_R,BGM_DP,BGM_TP,BGC_DP,BGC_TP,TH_DP,TH_TP,IRHD_DP,IRHD_TP from members where target > 0 and chk = 0;", Cn, 3
'
'    'Dim i As Integer
'    Dim str2 As String
'    i = base
'    Do Until Rs.EOF
'        '選擇要貼上的欄位
'        rowstr = CStr(i)
'        columnstr1 = "D"
'        columnstr2 = "E"
'        columnstr3 = "F"
'        columnstr4 = "G"
'        columnstr5 = "H"
'        columnstr6 = "I"
'        columnstr7 = "J"
'        columnstr8 = "K"
'        columnstr9 = "L"
'        columnstr10 = "M"
'        columnstr11 = "N"
'        columnstr12 = "O"
'        columnstr13 = "P"
'        columnstr14 = "Q"
'        cellrow1 = columnstr1 & rowstr
'        cellrow2 = columnstr2 & rowstr
'        cellrow3 = columnstr3 & rowstr
'        cellrow4 = columnstr4 & rowstr
'        cellrow5 = columnstr5 & rowstr
'        cellrow6 = columnstr6 & rowstr
'        cellrow7 = columnstr7 & rowstr
'        cellrow8 = columnstr8 & rowstr
'        cellrow9 = columnstr9 & rowstr
'        cellrow11 = columnstr10 & rowstr
'        cellrow12 = columnstr12 & rowstr
'        cellrow13 = columnstr13 & rowstr
'        cellrow14 = columnstr14 & rowstr
'
'        Range(cellrow1).Select
'        ActiveCell = Rs.Fields("Dept")
'
'        Range(cellrow2).Select
'        ActiveCell = Rs.Fields("Name")
'
'        Range(cellrow3).Select
'        ActiveCell = Rs.Fields("DP")
'
'        Range(cellrow4).Select
'        ActiveCell = Rs.Fields("TP")
'
'        Range(cellrow5).Select
'        ActiveCell = Rs.Fields("Target")
'
'        Range(cellrow6).Select
'        ActiveCell = Rs.Fields("Reach_R")
'
'        Range(cellrow7).Select
'        ActiveCell = Rs.Fields("BGM_DP")
'
'        Range(cellrow8).Select
'        ActiveCell = Rs.Fields("BGM_TP")
'
'        Range(cellrow9).Select
'        ActiveCell = Rs.Fields("BGC_DP")
'
'        Range(cellrow10).Select
'        ActiveCell = Rs.Fields("BGC_TP")
'
'        Range(cellrow11).Select
'        ActiveCell = Rs.Fields("TH_DP")
'
'        Range(cellrow12).Select
'        ActiveCell = Rs.Fields("TH_TP")
'
'        Range(cellrow13).Select
'        ActiveCell = Rs.Fields("IRHD_DP")
'
'        Range(cellrow14).Select
'        ActiveCell = Rs.Fields("IRHD_TP")
'
'
'
'        Rs.MoveNext
'        i = i + 1
'    Loop
    
    
 'UID Dept Name DP TP Target Reach_R BGM_DP BGM_TP BGC_DP BGC_TP TH_DP TH_TP IRHD_DP IRHD_TP Chk D_created D_modified
        
        
        
        
        
'        sql = "update members " & _
'              "set "
'        If Field(0) <> "" Then sql = sql & "Dept = "
'        End If
'        If Field(1) <> "" Then sql = sql & "Name = "
'        End If
'        If Field(2) <> "" Then sql = sql & "DP = "
'        End If
'        If Field(3) <> "" Then sql = sql & "TP = "
'        End If
'        If Field(4) <> "" Then sql = sql & "Target = "
'        End If
'        If Field(5) <> "" Then sql = sql & "Reach_R = "
'        End If
'        If Field(6) <> "" Then sql = sql & "BGM_DP = "
'        End If
'        If Field(7) <> "" Then sql = sql & "BGM_TP = "
'        End If
'        If Field(8) <> "" Then sql = sql & "BGM_DP = "
'        End If
'        If Field(9) <> "" Then sql = sql & "BGC_DP = "
'        End If
'        If Field(10) <> "" Then sql = sql & "BGC_TP = "
'        End If
'        If Field(11) <> "" Then sql = sql & "IRHD_DP = "
'        End If
'        If Field(12) <> "" Then sql = sql & "IRHD_TP = "
'        End If
'        If Field(13) <> "" Then sql = sql & "Chk = "
'        End If
'        If Field(14) <> "" Then sql = sql & "D_created = "
'        End If
'        If Field(15) <> "" Then sql = sql & "D_modified = "
'        End If
'        sql = sql & "where dept = " & Chr(34) & d4 & Chr(34) & " AND name = " & Chr(34) & e4 & Chr(34) & ";"
        
        'sql = sql &
'     sql = "update members " & _
'        "set Dept = " & f4 & _
'        ", Name = " & i4 & _
'        ", DP = " & f4 & _
'        ", TP = " & g4 & _
'        ", Target = " & i4 & _
'        ", reach_R = " & i4 & _
'        ", BGM_DP = " & i4 & _
'        ", BGM_TP = " & i4 & _
'        ", BGC_DP = " & i4 & _
'        ", BGC_TP = " & i4 & _
'        ", TH_DP = " & i4 & _
'        ", TH_TP = " & i4 & _
'        ", IRHD_DP = " & i4 & _
'        ", IRHD_TP = " & i4 & _
'        ", Chk = " & i4 & _
'        ", D_created = " & i4 & _
'        ", D_modified = " & i4 & _
'        " where dept = " & Chr(34) & d4 & Chr(34) & " AND name = " & Chr(34) & e4 & Chr(34) & ";"

    
    
    
    
    
   
    
    
End Sub






Function setDataColumnCMD(iRow As Integer) As String
    'Dim iCol As Integer
    'Dim s2Array(iRow, 4) As String
    'For iCol = 1 To totalCol '資料串的資料存到陣列
    '    s2Array(iRow, iCol) = Cells(iRow, iCol)
    'Next iCol
    'Dim sql As String
    'sql = "update members " &
        "set Chk = 1, DP = " & s2Array(iRow, iCol) & ", TP = " & s2Array(iRow, iCol + 1) & ", reach_R = " & s2Array(iRow, iCol + 2) & _
        " where dept = " & Chr(34) & s2Array(iRow, iCol + 3) & Chr(34) & " AND name = " & Chr(34) & s2Array(iRow, iCol + 4) & Chr(34) & ";"

    'MsgBox sql
    
    
    
    
End Function
Sub SQL_test()

    record_test
    
    Dim Cn As New ADODB.connection
    Dim Cn2 As New ADODB.connection
    Dim Rs As New ADODB.Recordset
    Dim Rs2 As New ADODB.Recordset
    
    SQLIP = "localhost"
    SQLNAME = "membersDB"
    SQLID = "root"
    SQLPWD = "aa461192"
    Cn.Open "DRIVER=MySQL ODBC 5.3 Unicode Driver;SERVER=" & Trim(SQLIP) & _
    ";DATABASE=" & Trim(SQLNAME) & _
    ";UID=" & Trim(SQLID) & _
    ";password=" & Trim(SQLPWD)
    Cn2.Open "DRIVER=MySQL ODBC 5.3 Unicode Driver;SERVER=" & Trim(SQLIP) & _
    ";DATABASE=" & Trim(SQLNAME) & _
    ";UID=" & Trim(SQLID) & _
    ";password=" & Trim(SQLPWD)
    
    Rs.Open "select Dept,Name,DP,TP,Target,Reach_R,BGM_DP,BGM_TP,BGC_DP,BGC_TP,TH_DP,TH_TP,IRHD_DP,IRHD_TP from members where target > 0 and chk = 0;", Cn, 3


    Dim startIndex As Integer
    Dim endIndex As Integer
    startIndex = 4
    
    Dim i As Integer
    Dim str2 As String
    Dim tmpString As String
    i = startIndex
    
    
    '------------------------------
    '補齊業績為0不顯示的資料列
    '------------------------------
    
    Do Until Rs.EOF
    
        '選擇要貼上的欄位
        rowstr = CStr(i)
        columnstr1 = "D"
        columnstr2 = "E"
        columnstr3 = "F"
        columnstr4 = "G"
        columnstr5 = "H"
        columnstr6 = "I"
        columnstr7 = "J"
        columnstr8 = "K"
        columnstr9 = "L"
        columnstr10 = "M"
        columnstr11 = "N"
        columnstr12 = "O"
        columnstr13 = "P"
        columnstr14 = "Q"
        cellrow1 = columnstr1 & rowstr
        cellrow2 = columnstr2 & rowstr
        cellrow3 = columnstr3 & rowstr
        cellrow4 = columnstr4 & rowstr
        cellrow5 = columnstr5 & rowstr
        cellrow6 = columnstr6 & rowstr
        cellrow7 = columnstr7 & rowstr
        cellrow8 = columnstr8 & rowstr
        cellrow9 = columnstr9 & rowstr
        cellrow10 = columnstr10 & rowstr
        cellrow11 = columnstr11 & rowstr
        cellrow12 = columnstr12 & rowstr
        cellrow13 = columnstr13 & rowstr
        cellrow14 = columnstr14 & rowstr
        
        tmpString = Rs.Fields("Dept")

        Do While strCompare(tmpString, Range(cellrow1).Value) = True And strCompare(tmpString, Range(cellrow1).Offset(1, 0).Value) = False
        '比對到相同的字串且再比對到不同的字串就執行

            Range(columnstr1 & CStr(i + 1)).Select
            'MsgBox Selection.Address(ReferenceStyle:=xlA1, _
                           RowAbsolute:=False, ColumnAbsolute:=False)
                           
            '插入空白儲存格
            'Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
            '插入空白列
            Rows(i + 1).Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
            
            ActiveCell = tmpString
            'MsgBox (cellrow1)
            
            Range(columnstr2 & CStr(i + 1)).Select
            ActiveCell = Rs.Fields("Name")
            'MsgBox (cellrow2)
            
            Range(columnstr3 & CStr(i + 1)).Select
            'ActiveCell = Rs.Fields("DP")
            ActiveCell = 0
            'MsgBox (cellrow3)
            
            Range(columnstr4 & CStr(i + 1)).Select
            ActiveCell = Rs.Fields("TP")
            'MsgBox (cellrow4)
            
            Range(columnstr5 & CStr(i + 1)).Select
            Dim tmpCal As Long
            tmpCal = Rs.Fields("Target")
            ActiveCell = tmpCal / 1000
            
            Range(columnstr6 & CStr(i + 1)).Select
            'Dim tmpRate As Long
            tmpRate = Rs.Fields("Reach_R")
            ActiveCell = tmpRate
            'MsgBox tmpRate & "%"
            'ActiveCell = CStr(tmpRate * 100 Mod 1) & "%"
            
            'ActiveCell = Rs.Fields("Reach_R")
            
            Range(columnstr7 & CStr(i + 1)).Select
            If Rs.Fields("BGM_DP") <> 0 Then
            ActiveCell = Rs.Fields("BGM_DP")
            End If
            
            Range(columnstr8 & CStr(i + 1)).Select
            If Rs.Fields("BGM_TP") <> 0 Then
            ActiveCell = Rs.Fields("BGM_TP")
            End If
            
            Range(columnstr9 & CStr(i + 1)).Select
            If Rs.Fields("BGC_DP") <> 0 Then
            ActiveCell = Rs.Fields("BGC_DP")
            End If
            
            Range(columnstr10 & CStr(i + 1)).Select
            If Rs.Fields("BGC_TP") <> 0 Then
            ActiveCell = Rs.Fields("BGC_TP")
            End If
            
            Range(columnstr11 & CStr(i + 1)).Select
            If Rs.Fields("TH_DP") <> 0 Then
            ActiveCell = Rs.Fields("TH_DP")
            End If
            
            Range(columnstr12 & CStr(i + 1)).Select
            If Rs.Fields("TH_TP") <> 0 Then
            ActiveCell = Rs.Fields("TH_TP")
            End If
            
            Range(columnstr13 & CStr(i + 1)).Select
            If Rs.Fields("IRHD_DP") <> 0 Then
            ActiveCell = Rs.Fields("IRHD_DP")
            End If

            Range(columnstr14 & CStr(i + 1)).Select
            If Rs.Fields("IRHD_TP") <> 0 Then
            ActiveCell = Rs.Fields("IRHD_TP")
            End If
            
            Rs.MoveNext
        Loop

        i = i + 1
        
    Loop
    
    '------------------------------
    '清空chk紀錄
    '------------------------------
    
    Dim sql As String
    sql = "update members set chk = " & Chr(34) & "0" & Chr(34) & ";"
    Cn.Execute (sql)
    
    '------------------------------
    '計算共幾列的資料列
    '------------------------------
    
    Rs2.Open "select count(*) from members where target > 0 and chk = 0;", Cn2, 3
    endIndex = Rs2.Fields("count(*)") + startIndex - 1
    
    'Range("F4:F20").Select
    'Range("F20").Activate
    'ActiveCell.FormulaR1C1 = "=SUM(R[-16]C:R[-1]C)"

    Range("G4:G20").Select
    Range("G20").Activate
    ActiveCell.FormulaR1C1 = "=SUM(R[-16]C:R[-1]C)" 'SUM(G4:G19)
    
    Range("H4:H20").Select
    Range("H20").Activate
    ActiveCell.FormulaR1C1 = "=SUM(R[-16]C:R[-1]C)" 'SUM(H4:H19)

    Range("I20").Activate
    Dim tmp As Long
    tmp = Range("H20") * 1000
    'MsgBox ((CStr(Range("G20") / tmp) Mod 1) & "%")
    Range("I20").Activate
    With Selection.Font
    .Name = "SimSun"
    .FontStyle = "粗體"
    .Size = 13
    .Color = 255
    End With
    Selection.NumberFormatLocal = "0.00%"
    ActiveCell = Round(Range("G20") / tmp, startIndex)
    '等同ActiveCell = Round(Range("G20") / tmp, 4) * 100 & "%"
    MsgBox ("startIndex = " & startIndex)
    MsgBox ("endIndex = " & endIndex)
    
    
    '------------------------------
    '清除儲存格
    '------------------------------
    
    Range("J20:Q20").ClearContents

    '------------------------------
    '計算各行總和
    '------------------------------
    
    Range("J20").Activate
    If getSumCol("J", startIndex, endIndex) <> 0 Then
    ActiveCell = getSumCol("J", startIndex, endIndex)
    End If
    
    Range("K20").Activate
    If getSumCol("K", startIndex, endIndex) <> 0 Then
    ActiveCell = getSumCol("K", startIndex, endIndex)
    End If

    Range("L20").Activate
    If getSumCol("L", startIndex, endIndex) <> 0 Then
    ActiveCell = getSumCol("L", startIndex, endIndex)
    End If
    
    Range("M20").Activate
    If getSumCol("M", startIndex, endIndex) <> 0 Then
    ActiveCell = getSumCol("M", startIndex, endIndex)
    End If
    
    Range("N20").Activate
    If getSumCol("N", startIndex, endIndex) <> 0 Then
    ActiveCell = getSumCol("N", startIndex, endIndex)
    End If
    
    Range("O20").Activate
    If getSumCol("O", startIndex, endIndex) <> 0 Then
    ActiveCell = getSumCol("O", startIndex, endIndex)
    End If
    
    Range("P20").Activate
    If getSumCol("P", startIndex, endIndex) <> 0 Then
    ActiveCell = getSumCol("P", startIndex, endIndex)
    End If
    
    Range("Q20").Activate
    If getSumCol("Q", startIndex, endIndex) <> 0 Then
    ActiveCell = getSumCol("Q", startIndex, endIndex)
    End If
    
    
    
    
    
End Sub

Function getSumCol(rangeCol As String, startNum As Integer, endNum As Integer) As Integer
    Dim SumCol As Integer
    Dim tempNum As Integer
    tempNum = startNum
    Do While tempNum <= endNum
        'MsgBox ("SumCol = " & SumCol)
        If Range(rangeCol & CStr(tempNum)) = "" Then   '判斷range是否為空白
            SumCol = SumCol + 0 '是空白就加零
        Else
            SumCol = SumCol + Range(rangeCol & CStr(tempNum)) '不是空白就加range本身的值
        End If
        tempNum = tempNum + 1 '做下一個
    Loop
    'MsgBox ("SumCol = " & SumCol)
    getSumCol = SumCol '回傳
    'MsgBox ("getSumCol = " & getSumCol)
End Function


Option Explicit

Public Const Mname As String = "MyPopUpMenu"

Sub DeletePopUpMenu()
    ' Delete the popup menu if it already exists.
    On Error Resume Next
    Application.CommandBars(Mname).Delete
    On Error GoTo 0
End Sub

Sub CreateDisplayPopUpMenu()
    ' Delete any existing popup menu.
    Call DeletePopUpMenu

    ' Create the popup menu.
    Call Custom_PopUpMenu_1

    ' Display the popup menu.
    On Error Resume Next
    Application.CommandBars(Mname).ShowPopup
    On Error GoTo 0
End Sub

Sub Custom_PopUpMenu_1()
    Dim MenuItem As CommandBarPopup
    ' Add the popup menu.
    With Application.CommandBars.Add(Name:=Mname, Position:=msoBarPopup, _
         MenuBar:=False, Temporary:=True)

        ' First, add two buttons to the menu.
        With .Controls.Add(Type:=msoControlButton)
            .Caption = "Button 1"
            .FaceId = 71
            .OnAction = "'" & ThisWorkbook.Name & "'!" & "TestMacro"
        End With

        With .Controls.Add(Type:=msoControlButton)
            .Caption = "Button 2"
            .FaceId = 72
            .OnAction = "'" & ThisWorkbook.Name & "'!" & "TestMacro"
        End With

        ' Next, add a menu that contains two buttons.
        Set MenuItem = .Controls.Add(Type:=msoControlPopup)
        With MenuItem
            .Caption = "My Special Menu"

            With .Controls.Add(Type:=msoControlButton)
                .Caption = "Button 1 in menu"
                .FaceId = 71
                .OnAction = "'" & ThisWorkbook.Name & "'!" & "TestMacro"
            End With

            With .Controls.Add(Type:=msoControlButton)
                .Caption = "Button 2 in menu"
                .FaceId = 72
                .OnAction = "'" & ThisWorkbook.Name & "'!" & "TestMacro"
            End With
        End With

        ' Finally, add a single button.
        With .Controls.Add(Type:=msoControlButton)
            .Caption = "Button 3"
            .FaceId = 73
            .OnAction = "'" & ThisWorkbook.Name & "'!" & "TestMacro"
        End With

    End With
End Sub

Sub TestMacro()
    MsgBox "Hi there! Greetings from the Netherlands."
End Sub

